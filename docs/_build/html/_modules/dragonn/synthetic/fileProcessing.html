

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>dragonn.synthetic.fileProcessing &mdash; DragoNN 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="DragoNN 0.1 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../../index.html" class="fa fa-home"> DragoNN</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../dragonn.html">dragonn package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dragonn.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dragonn.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dragonn.html#module-dragonn">Module contents</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">DragoNN</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>dragonn.synthetic.fileProcessing</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for dragonn.synthetic.fileProcessing</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">import</span> <span class="nn">gzip</span>


<div class="viewcode-block" id="assertParameterNecessaryForMode"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.assertParameterNecessaryForMode">[docs]</a><span class="k">def</span> <span class="nf">assertParameterNecessaryForMode</span><span class="p">(</span><span class="n">parameterName</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">modeName</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">parameter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="n">parameterName</span> <span class="o">+</span> <span class="s">&quot; is necessary when &quot;</span> <span class="o">+</span> <span class="n">modeName</span> <span class="o">+</span> <span class="s">&quot; is &quot;</span> <span class="o">+</span> <span class="n">mode</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="assertParameterIrrelevantForMode"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.assertParameterIrrelevantForMode">[docs]</a><span class="k">def</span> <span class="nf">assertParameterIrrelevantForMode</span><span class="p">(</span><span class="n">parameterName</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">modeName</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">parameter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="n">parameterName</span> <span class="o">+</span> <span class="s">&quot; is irrelevant when &quot;</span> <span class="o">+</span> <span class="n">modeName</span> <span class="o">+</span> <span class="s">&quot; is &quot;</span> <span class="o">+</span> <span class="n">mode</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="unsupportedValueForMode"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.unsupportedValueForMode">[docs]</a><span class="k">def</span> <span class="nf">unsupportedValueForMode</span><span class="p">(</span><span class="n">modeName</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Unsupported value for &quot;</span> <span class="o">+</span> <span class="n">modeName</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="getCoreFileName"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.getCoreFileName">[docs]</a><span class="k">def</span> <span class="nf">getCoreFileName</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">getFileNameParts</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">coreFileName</span>

</div>
<div class="viewcode-block" id="getFileNameParts"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.getFileNameParts">[docs]</a><span class="k">def</span> <span class="nf">getFileNameParts</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;^(.*/)?([^\./]+)(\.[^/]*)?$&quot;</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">FileNameParts</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="FileNameParts"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.FileNameParts">[docs]</a><span class="k">class</span> <span class="nc">FileNameParts</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">coreFileName</span><span class="p">,</span> <span class="n">extension</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span> <span class="k">if</span> <span class="p">(</span><span class="n">directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coreFileName</span> <span class="o">=</span> <span class="n">coreFileName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">=</span> <span class="n">extension</span>

<div class="viewcode-block" id="FileNameParts.getFullPath"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.FileNameParts.getFullPath">[docs]</a>    <span class="k">def</span> <span class="nf">getFullPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span>
</div>
<div class="viewcode-block" id="FileNameParts.getCoreFileNameAndExtension"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.FileNameParts.getCoreFileNameAndExtension">[docs]</a>    <span class="k">def</span> <span class="nf">getCoreFileNameAndExtension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreFileName</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span>
</div>
<div class="viewcode-block" id="FileNameParts.getCoreFileNameWithTransformation"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.FileNameParts.getCoreFileNameWithTransformation">[docs]</a>    <span class="k">def</span> <span class="nf">getCoreFileNameWithTransformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">transformation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coreFileName</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FileNameParts.getFileNameWithTransformation"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.FileNameParts.getFileNameWithTransformation">[docs]</a>    <span class="k">def</span> <span class="nf">getFileNameWithTransformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">toReturn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoreFileNameWithTransformation</span><span class="p">(</span><span class="n">transformation</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">extension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">toReturn</span> <span class="o">=</span> <span class="n">toReturn</span> <span class="o">+</span> <span class="n">extension</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">toReturn</span> <span class="o">=</span> <span class="n">toReturn</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span>
        <span class="k">return</span> <span class="n">toReturn</span>
</div>
<div class="viewcode-block" id="FileNameParts.getFilePathWithTransformation"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.FileNameParts.getFilePathWithTransformation">[docs]</a>    <span class="k">def</span> <span class="nf">getFilePathWithTransformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileNameWithTransformation</span><span class="p">(</span><span class="n">transformation</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="n">extension</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="getFileHandle"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.getFileHandle">[docs]</a><span class="k">def</span> <span class="nf">getFileHandle</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;.gz$&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;.gzip&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;r&quot;</span><span class="p">):</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;rt&quot;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;w&quot;</span><span class="p">):</span>
            <span class="c"># I think write will actually append if the file already</span>
            <span class="c"># exists...so you want to remove it if it exists</span>
            <span class="kn">import</span> <span class="nn">os.path</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

<span class="c"># returns an array of all filter variables.</span>

</div>
<div class="viewcode-block" id="splitLinesIntoOtherFiles"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.splitLinesIntoOtherFiles">[docs]</a><span class="k">def</span> <span class="nf">splitLinesIntoOtherFiles</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">,</span> <span class="n">preprocessingStep</span><span class="p">,</span> <span class="n">filterVariableFromLine</span><span class="p">,</span> <span class="n">outputFilePathFromFilterVariable</span><span class="p">):</span>
    <span class="n">filterVariablesToReturn</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">filterVariableToOutputFileHandle</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileHandle</span><span class="p">:</span>
        <span class="n">processedLine</span> <span class="o">=</span> <span class="n">line</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">preprocessingStep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">processedLine</span> <span class="o">=</span> <span class="n">preprocessingStep</span><span class="p">(</span><span class="n">processedLine</span><span class="p">)</span>
        <span class="n">filterVariable</span> <span class="o">=</span> <span class="n">filterVariableFromLine</span><span class="p">(</span><span class="n">processedLine</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">filterVariable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filterVariableToOutputFileHandle</span><span class="p">):</span>
            <span class="n">outputFilePath</span> <span class="o">=</span> <span class="n">outputFilePathFromFilterVariable</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">)</span>
            <span class="n">filterVariablesToReturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">)</span>
            <span class="n">outputFileHandle</span> <span class="o">=</span> <span class="n">getFileHandle</span><span class="p">(</span><span class="n">outputFilePath</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">filterVariableToOutputFileHandle</span><span class="p">[</span><span class="n">filterVariable</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputFileHandle</span>
        <span class="n">outputFileHandle</span> <span class="o">=</span> <span class="n">filterVariableToOutputFileHandle</span><span class="p">[</span><span class="n">filterVariable</span><span class="p">]</span>
        <span class="n">outputFileHandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fileHandle</span> <span class="ow">in</span> <span class="n">filterVariableToOutputFileHandle</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">fileHandle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">filterVariablesToReturn</span>

<span class="c"># transformation has a specified default so that this can be used to, for</span>
<span class="c"># instance, unzip a gzipped file.</span>

</div>
<div class="viewcode-block" id="transformFile"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.transformFile">[docs]</a><span class="k">def</span> <span class="nf">transformFile</span><span class="p">(</span>
    <span class="c"># should be some function of the line and the line number</span>
    <span class="c"># processing to be applied before filterFunction AND transformation</span>
    <span class="n">fileHandle</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">outputTitleFromInputTitle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filterFunction</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">preprocessing</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">progressUpdate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">progressUpdateFileName</span><span class="o">=</span><span class="bp">None</span>
<span class="p">):</span>

    <span class="n">outputFileHandle</span> <span class="o">=</span> <span class="n">getFileHandle</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">action</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">outputFileHandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileHandle</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">outputTitleFromInputTitle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">outputFileHandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outputTitleFromInputTitle</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
        <span class="n">processLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">,</span>
                    <span class="n">filterFunction</span><span class="p">,</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
        <span class="n">printProgress</span><span class="p">(</span><span class="n">progressUpdate</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">progressUpdateFileName</span><span class="p">)</span>
    <span class="n">outputFileHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># reades a line of the file on-demand.</span>

</div>
<div class="viewcode-block" id="FileReader"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.FileReader">[docs]</a><span class="k">class</span> <span class="nc">FileReader</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileHandle</span><span class="p">,</span> <span class="n">preprocessing</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filterFunction</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileHandle</span> <span class="o">=</span> <span class="n">fileHandle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span> <span class="o">=</span> <span class="n">preprocessing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filterFunction</span> <span class="o">=</span> <span class="n">filterFunction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span> <span class="o">=</span> <span class="n">transformation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreInputTitle</span> <span class="o">=</span> <span class="n">ignoreInputTitle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="FileReader.getNextLine"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.FileReader.getNextLine">[docs]</a>    <span class="k">def</span> <span class="nf">getNextLine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileHandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">):</span>  <span class="c"># empty string is eof...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ignoreInputTitle</span> <span class="o">==</span> <span class="bp">True</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">line</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNextLine</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>  <span class="c"># to be passed into processLine</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toReturn</span> <span class="o">=</span> <span class="n">x</span>

            <span class="n">processLine</span><span class="p">(</span>
                <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ignoreInputTitle</span><span class="p">,</span> <span class="n">preprocessing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">,</span> <span class="n">filterFunction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filterFunction</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">toReturn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">return</span> <span class="bp">None</span>

</div></div>
<div class="viewcode-block" id="writeToFile"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.writeToFile">[docs]</a><span class="k">def</span> <span class="nf">writeToFile</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
    <span class="n">outputFileHandle</span> <span class="o">=</span> <span class="n">getFileHandle</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">writeToFileHandle</span><span class="p">(</span><span class="n">outputFileHandle</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="writeToFileHandle"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.writeToFileHandle">[docs]</a><span class="k">def</span> <span class="nf">writeToFileHandle</span><span class="p">(</span><span class="n">outputFileHandle</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
    <span class="n">outputFileHandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
    <span class="n">outputFileHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="transformFileIntoArray"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.transformFileIntoArray">[docs]</a><span class="k">def</span> <span class="nf">transformFileIntoArray</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">readRowsIntoArr</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="performActionOnEachLineOfFile"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.performActionOnEachLineOfFile">[docs]</a><span class="k">def</span> <span class="nf">performActionOnEachLineOfFile</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="bp">None</span>  <span class="c"># should be a function that accepts the preprocessed/filtered line and the line number</span>
                                  <span class="c"># the preprocessing step is performed before</span>
                                  <span class="c"># both &#39;filterFunction&#39; and &#39;transformation&#39;.</span>
                                  <span class="c"># Originally I just had &#39;transformation&#39;.</span>
                                  <span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filterFunction</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">preprocessing</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">actionFromTitle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">progressUpdate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">progressUpdateFileName</span><span class="o">=</span><span class="bp">None</span>
                                  <span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">actionFromTitle</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">action</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;One of actionFromTitle or action should not be None&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">actionFromTitle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s">&quot;Only one of actionFromTitle or action can be non-None&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">actionFromTitle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">ignoreInputTitle</span> <span class="o">==</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s">&quot;If actionFromTitle is not None, ignoreInputTitle should probably be True because it implies a title is present&quot;</span><span class="p">)</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileHandle</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">actionFromTitle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">actionFromTitle</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">processLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">,</span>
                    <span class="n">filterFunction</span><span class="p">,</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">progressUpdate</span><span class="p">)</span>
        <span class="n">printProgress</span><span class="p">(</span><span class="n">progressUpdate</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">progressUpdateFileName</span><span class="p">)</span>

    <span class="n">fileHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="performActionInBatchesOnEachLineOfFile"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.performActionInBatchesOnEachLineOfFile">[docs]</a><span class="k">def</span> <span class="nf">performActionInBatchesOnEachLineOfFile</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">,</span> <span class="n">batchSize</span><span class="p">,</span> <span class="n">actionOnLineInBatch</span><span class="p">,</span> <span class="n">actionAtEndOfBatch</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">filterFunction</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">preprocessing</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">progressUpdate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">):</span>
        <span class="n">actionOnLineInBatch</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lineNumber</span> <span class="o">%</span> <span class="n">batchSize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">actionAtEndOfBatch</span><span class="p">()</span>
    <span class="n">performActionOnEachLineOfFile</span><span class="p">(</span>
        <span class="n">fileHandle</span><span class="o">=</span><span class="n">fileHandle</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">transformation</span><span class="p">,</span> <span class="n">filterFunction</span><span class="o">=</span><span class="n">filterFunction</span><span class="p">,</span> <span class="n">preprocessing</span><span class="o">=</span><span class="n">preprocessing</span><span class="p">,</span> <span class="n">progressUpdate</span><span class="o">=</span><span class="n">progressUpdate</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="o">=</span><span class="n">ignoreInputTitle</span>
    <span class="p">)</span>
    <span class="n">actionAtEndOfBatch</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="processLine"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.processLine">[docs]</a><span class="k">def</span> <span class="nf">processLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">,</span> <span class="n">filterFunction</span><span class="p">,</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">progressUpdate</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ignoreInputTitle</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">preprocessing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">filterFunction</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">filterFunction</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">)):</span>
            <span class="n">action</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">line</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="printProgress"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.printProgress">[docs]</a><span class="k">def</span> <span class="nf">printProgress</span><span class="p">(</span><span class="n">progressUpdate</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">fileName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">progressUpdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">progressUpdate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Processed &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; lines&quot;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="s">&quot;&quot;</span> <span class="k">if</span> <span class="n">fileName</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot; of &quot;</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="defaultTabSeppd"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.defaultTabSeppd">[docs]</a><span class="k">def</span> <span class="nf">defaultTabSeppd</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">trimNewline</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">splitByTabs</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>

</div>
<div class="viewcode-block" id="defaultWhitespaceSeppd"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.defaultWhitespaceSeppd">[docs]</a><span class="k">def</span> <span class="nf">defaultWhitespaceSeppd</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">trimNewline</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">s</span>

</div>
<div class="viewcode-block" id="trimNewline"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.trimNewline">[docs]</a><span class="k">def</span> <span class="nf">trimNewline</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="appendNewline"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.appendNewline">[docs]</a><span class="k">def</span> <span class="nf">appendNewline</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>  <span class="c"># aargh O(n) aargh FIXME if you can</span>

</div>
<div class="viewcode-block" id="splitByDelimiter"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.splitByDelimiter">[docs]</a><span class="k">def</span> <span class="nf">splitByDelimiter</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="splitByTabs"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.splitByTabs">[docs]</a><span class="k">def</span> <span class="nf">splitByTabs</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">splitByDelimiter</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="stringToFloat"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.stringToFloat">[docs]</a><span class="k">def</span> <span class="nf">stringToFloat</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="stringToInt"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.stringToInt">[docs]</a><span class="k">def</span> <span class="nf">stringToInt</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="lambdaMaker_getAtPosition"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.lambdaMaker_getAtPosition">[docs]</a><span class="k">def</span> <span class="nf">lambdaMaker_getAtPosition</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="lambdaMaker_insertSuffixIntoFileName"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.lambdaMaker_insertSuffixIntoFileName">[docs]</a><span class="k">def</span> <span class="nf">lambdaMaker_insertSuffixIntoFileName</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="n">separator</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">fileName</span><span class="p">:</span> <span class="n">getFileNameParts</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">getFileNameWithTransformation</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">coreFileName</span><span class="p">:</span> <span class="n">coreFileName</span> <span class="o">+</span> <span class="n">separator</span> <span class="o">+</span> <span class="n">suffix</span>
    <span class="p">)</span>

</div>
<div class="viewcode-block" id="lambdaMaker_insertPrefixIntoFileName"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.lambdaMaker_insertPrefixIntoFileName">[docs]</a><span class="k">def</span> <span class="nf">lambdaMaker_insertPrefixIntoFileName</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">separator</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">fileName</span><span class="p">:</span> <span class="n">getFileNameParts</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">getFileNameWithTransformation</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">coreFileName</span><span class="p">:</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">separator</span> <span class="o">+</span> <span class="n">coreFileName</span>
    <span class="p">)</span>

</div>
<div class="viewcode-block" id="simpleDictionaryFromFile"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.simpleDictionaryFromFile">[docs]</a><span class="k">def</span> <span class="nf">simpleDictionaryFromFile</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">,</span> <span class="n">keyIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">valIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">titlePresent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">defaultTabSeppd</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
    <span class="n">toReturn</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">):</span>
        <span class="n">toReturn</span><span class="p">[</span><span class="n">inp</span><span class="p">[</span><span class="n">keyIndex</span><span class="p">]]</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[</span><span class="n">valIndex</span><span class="p">]</span>
    <span class="n">performActionOnEachLineOfFile</span><span class="p">(</span>
        <span class="n">fileHandle</span><span class="o">=</span><span class="n">fileHandle</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">transformation</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="o">=</span><span class="n">titlePresent</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">toReturn</span>
</div>
<span class="sd">&#39;&#39;&#39;Accepts a title, uses it to produce a function that generates a dictionary given an array&#39;&#39;&#39;</span>


<div class="viewcode-block" id="lambdaMaker_dictionaryFromLine"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.lambdaMaker_dictionaryFromLine">[docs]</a><span class="k">def</span> <span class="nf">lambdaMaker_dictionaryFromLine</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="n">lineToArr</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">chainFunctions</span><span class="p">(</span>
        <span class="n">trimNewline</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">splitByDelimiter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">))</span>
    <span class="n">splitTitle</span> <span class="o">=</span> <span class="n">lineToArr</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lineToDictionary</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="n">toReturn</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lineToArr</span><span class="p">(</span><span class="n">line</span><span class="p">)):</span>
            <span class="n">toReturn</span><span class="p">[</span><span class="n">splitTitle</span><span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">toReturn</span>
    <span class="k">return</span> <span class="n">lineToDictionary</span>

<span class="c"># wrapper for the cat command</span>

</div>
<div class="viewcode-block" id="concatenateFiles"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.concatenateFiles">[docs]</a><span class="k">def</span> <span class="nf">concatenateFiles</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">arrOfFilesToConcatenate</span><span class="p">):</span>
    <span class="n">util</span><span class="o">.</span><span class="n">executeAsSystemCall</span><span class="p">(</span>
        <span class="s">&quot;cat &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arrOfFilesToConcatenate</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot; &gt; &quot;</span> <span class="o">+</span> <span class="n">outputFile</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="concatenateFiles_preprocess"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.concatenateFiles_preprocess">[docs]</a><span class="k">def</span> <span class="nf">concatenateFiles_preprocess</span><span class="p">(</span>
    <span class="c"># x is the input line, y is the transformed input file name (see</span>
    <span class="c"># inputFileNameTransformation)</span>
    <span class="c"># the function that transforms the path of the input file</span>
    <span class="c"># function that takes input title and transforms into output title.</span>
    <span class="c"># Considers title of first file in line.</span>
    <span class="c"># really unfortunately named. Should have been named &#39;titlePresent&#39;</span>
    <span class="n">outputFile</span><span class="p">,</span> <span class="n">arrOfFilesToConcatenate</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">inputFileTransformation</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">getFileNameParts</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">coreFileName</span><span class="p">,</span> <span class="n">outputTitleFromInputTitle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="o">=</span><span class="bp">False</span>
<span class="p">):</span>
    <span class="n">inputTitle</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">outputFileHandle</span> <span class="o">=</span> <span class="n">getFileHandle</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">aFile</span> <span class="ow">in</span> <span class="n">arrOfFilesToConcatenate</span><span class="p">:</span>
        <span class="n">transformedInputFilename</span> <span class="o">=</span> <span class="n">inputFileTransformation</span><span class="p">(</span><span class="n">aFile</span><span class="p">)</span>
        <span class="n">aFileHandle</span> <span class="o">=</span> <span class="n">getFileHandle</span><span class="p">(</span><span class="n">aFile</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">aFileHandle</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">outputTitleFromInputTitle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">inputTitle</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                        <span class="n">inputTitle</span> <span class="o">=</span> <span class="n">line</span>
                        <span class="n">outputFileHandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="n">outputTitleFromInputTitle</span><span class="p">(</span><span class="n">inputTitle</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ignoreInputTitle</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)):</span>
                <span class="n">outputFileHandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span>
                    <span class="n">line</span><span class="p">,</span> <span class="n">transformedInputFilename</span><span class="p">))</span>
    <span class="n">outputFileHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="readRowsIntoArr"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.readRowsIntoArr">[docs]</a><span class="k">def</span> <span class="nf">readRowsIntoArr</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">,</span> <span class="n">progressUpdate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">titlePresent</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">progressUpdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lineNumber</span> <span class="o">%</span> <span class="n">progressUpdate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;processed &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lineNumber</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; lines&quot;</span><span class="p">)</span>
        <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="n">performActionOnEachLineOfFile</span><span class="p">(</span>
        <span class="n">fileHandle</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">trimNewline</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="o">=</span><span class="n">titlePresent</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">arr</span>

</div>
<div class="viewcode-block" id="writeRowsToFile"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.writeRowsToFile">[docs]</a><span class="k">def</span> <span class="nf">writeRowsToFile</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">theFile</span><span class="p">):</span>
    <span class="n">writeRowsToFileHandle</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">getFileHandle</span><span class="p">(</span><span class="n">theFile</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="writeRowsToFileHandle"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.writeRowsToFileHandle">[docs]</a><span class="k">def</span> <span class="nf">writeRowsToFileHandle</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">fileHandle</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">fileHandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">fileHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="readColIntoArr"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.readColIntoArr">[docs]</a><span class="k">def</span> <span class="nf">readColIntoArr</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">titlePresent</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">):</span>
        <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inp</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">performActionOnEachLineOfFile</span><span class="p">(</span>
        <span class="n">fileHandle</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">defaultTabSeppd</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="o">=</span><span class="n">titlePresent</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">arr</span>

</div>
<div class="viewcode-block" id="read2DMatrix"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.read2DMatrix">[docs]</a><span class="k">def</span> <span class="nf">read2DMatrix</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">,</span> <span class="n">colNamesPresent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">rowNamesPresent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">contentType</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">contentStartIndex</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">contentEndIndex</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">progressUpdate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">numpify</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;numpify&quot; will return a numpy mat for the rows</span>
<span class="sd">        returns an instance of util.Titled2DMatrix</span>
<span class="sd">        Has attributes rows, rowNames, colNames</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fileHandle</span> <span class="o">=</span> <span class="n">getFileHandle</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">fileHandle</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">fileHandle</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">contentStartIndex</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">contentStartIndex</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">rowNamesPresent</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">contentEndIndex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">contentEndIndex</span> <span class="o">&gt;</span> <span class="n">contentStartIndex</span>
    <span class="n">titled2DMatrix</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Titled2DMatrix</span><span class="p">(</span>
        <span class="n">colNamesPresent</span><span class="o">=</span><span class="n">colNamesPresent</span><span class="p">,</span> <span class="n">rowNamesPresent</span><span class="o">=</span><span class="n">rowNamesPresent</span><span class="p">)</span>
    <span class="n">contentEndIndexWrapper</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">VariableWrapper</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lineNumber</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">colNamesPresent</span><span class="p">):</span>
            <span class="n">contentEndIndexWrapper</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">inp</span><span class="p">)</span> <span class="k">if</span> <span class="n">contentEndIndex</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">contentEndIndex</span>
            <span class="n">titled2DMatrix</span><span class="o">.</span><span class="n">setColNames</span><span class="p">(</span>
                <span class="n">inp</span><span class="p">[</span><span class="n">contentStartIndex</span><span class="p">:</span><span class="n">contentEndIndexWrapper</span><span class="o">.</span><span class="n">var</span><span class="p">])</span>
            <span class="k">assert</span> <span class="n">contentEndIndexWrapper</span><span class="o">.</span><span class="n">var</span> <span class="o">&gt;</span> <span class="n">contentStartIndex</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rowName</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">rowNamesPresent</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="c"># ignore the column denoting the name of the row</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">contentType</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inp</span><span class="p">[</span>
                <span class="n">contentStartIndex</span><span class="p">:</span><span class="n">contentEndIndexWrapper</span><span class="o">.</span><span class="n">var</span><span class="p">]]</span>
            <span class="n">titled2DMatrix</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">rowName</span><span class="o">=</span><span class="n">rowName</span><span class="p">)</span>
    <span class="n">performActionOnEachLineOfFile</span><span class="p">(</span>
        <span class="n">fileHandle</span><span class="o">=</span><span class="n">fileHandle</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">defaultTabSeppd</span><span class="p">,</span> <span class="n">ignoreInputTitle</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">progressUpdate</span><span class="o">=</span><span class="n">progressUpdate</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">numpify</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
        <span class="n">titled2DMatrix</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">titled2DMatrix</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">titled2DMatrix</span>

</div>
<div class="viewcode-block" id="SubsetOfColumnsToUseOptions"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.SubsetOfColumnsToUseOptions">[docs]</a><span class="k">class</span> <span class="nc">SubsetOfColumnsToUseOptions</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;setOfColumnNames&#39;</span><span class="p">,</span> <span class="n">columnNames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columnNames</span> <span class="o">=</span> <span class="n">columnNames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integrityChecks</span><span class="p">()</span>

<div class="viewcode-block" id="SubsetOfColumnsToUseOptions.integrityChecks"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.SubsetOfColumnsToUseOptions.integrityChecks">[docs]</a>    <span class="k">def</span> <span class="nf">integrityChecks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;setOfColumnNames&#39;</span><span class="p">):</span>
            <span class="n">assertParameterIrrelevantForMode</span><span class="p">(</span>
                <span class="s">&quot;N&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="s">&quot;subsetOfColumnsToUseMode&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
            <span class="n">assertParameterNecessaryForMode</span><span class="p">(</span>
                <span class="s">&quot;columnNames&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnNames</span><span class="p">,</span> <span class="s">&quot;subsetOfColumnsToUseMode&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;topN&#39;</span><span class="p">):</span>
            <span class="n">assertParameterIrrelevantForMode</span><span class="p">(</span>
                <span class="s">&quot;columnNames&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnNames</span><span class="p">,</span> <span class="s">&quot;subsetOfColumnsToUseMode&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
            <span class="n">assertParameterNecessaryForMode</span><span class="p">(</span>
                <span class="s">&quot;N&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="s">&quot;subsetOfColumnsToUseMode&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># unsupportedValueForMode(modeName, mode)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="getCoreTitledMappingAction"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.getCoreTitledMappingAction">[docs]</a><span class="k">def</span> <span class="nf">getCoreTitledMappingAction</span><span class="p">(</span><span class="n">subsetOfColumnsToUseOptions</span><span class="p">,</span> <span class="n">contentType</span><span class="p">,</span> <span class="n">contentStartIndex</span><span class="p">,</span> <span class="n">subsetOfRowsToUse</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">keyColumns</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">subsetOfRowsToUseMembershipDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subsetOfRowsToUse</span><span class="p">)</span> <span class="k">if</span> <span class="n">subsetOfRowsToUse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">None</span>
    <span class="n">indicesToCareAboutWrapper</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">VariableWrapper</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">titledMappingAction</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lineNumber</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>  <span class="c"># handling of the title</span>
            <span class="k">if</span> <span class="n">subsetOfColumnsToUseOptions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">columnOrdering</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[</span><span class="n">contentStartIndex</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">subsetOfColumnsToUseOptions</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">SubsetOfColumnsToUseMode</span><span class="o">.</span><span class="n">setOfColumnNames</span><span class="p">):</span>
                    <span class="n">columnOrdering</span> <span class="o">=</span> <span class="n">subsetOfColumnsToUseOptions</span><span class="o">.</span><span class="n">columnNames</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">subsetOfColumnsToUseOptions</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">SubsetOfColumnsToUseMode</span><span class="o">.</span><span class="n">topN</span><span class="p">):</span>
                    <span class="n">columnOrdering</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[</span>
                        <span class="n">contentStartIndex</span><span class="p">:</span><span class="n">contentStartIndex</span> <span class="o">+</span> <span class="n">SubsetOfColumnsToUseMode</span><span class="o">.</span><span class="n">topN</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="s">&quot;Unsupported subsetOfColumnsToUseOptions.mode: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">subsetOfColumnsToUseOptions</span><span class="o">.</span><span class="n">mode</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Subset of labels to use is specified&quot;</span><span class="p">)</span>
                <span class="n">indicesLookup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span>
                <span class="n">indicesToCareAboutWrapper</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">labelToUse</span> <span class="ow">in</span> <span class="n">columnOrdering</span><span class="p">:</span>
                    <span class="n">indicesToCareAboutWrapper</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">indicesLookup</span><span class="p">[</span><span class="n">labelToUse</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">columnOrdering</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># regular line processing</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">inp</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keyColumns</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">subsetOfRowsToUseMembershipDict</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">subsetOfRowsToUseMembershipDict</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">indicesToCareAboutWrapper</span><span class="o">.</span><span class="n">var</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                    <span class="n">arrToAdd</span> <span class="o">=</span> <span class="p">[</span><span class="n">contentType</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inp</span><span class="p">[</span><span class="n">contentStartIndex</span><span class="p">:]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arrToAdd</span> <span class="o">=</span> <span class="p">[</span><span class="n">contentType</span><span class="p">(</span><span class="n">inp</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
                                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indicesToCareAboutWrapper</span><span class="o">.</span><span class="n">var</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">key</span><span class="p">,</span> <span class="n">arrToAdd</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">titledMappingAction</span>

</div>
<div class="viewcode-block" id="readTitledMapping"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.readTitledMapping">[docs]</a><span class="k">def</span> <span class="nf">readTitledMapping</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">,</span> <span class="n">contentType</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">contentStartIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">subsetOfColumnsToUseOptions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">subsetOfRowsToUse</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">progressUpdate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">keyColumns</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns an instance of util.TitledMapping.</span>
<span class="sd">            util.TitledMapping has functions:</span>
<span class="sd">                - getTitledArrForKey(key): returns an instance of util.TitledArr which has: getCol(colName) and setCol(colName)</span>
<span class="sd">                - getArrForKey(key): returns the array for the key</span>
<span class="sd">                - keyPresenceCheck(key): throws an error if the key is absent</span>
<span class="sd">                Is also iterable! Returns an iterator of util.TitledArr</span>
<span class="sd">        subsetOfColumnsToUseOptions: instance of SubsetOfColumnsToUseOptions</span>
<span class="sd">        subsetOfRowsToUse: something that has a subset of row ids to be considered</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">titledMappingWrapper</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">VariableWrapper</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">coreTitledMappingAction</span> <span class="o">=</span> <span class="n">getCoreTitledMappingAction</span><span class="p">(</span><span class="n">subsetOfColumnsToUseOptions</span><span class="o">=</span><span class="n">subsetOfColumnsToUseOptions</span><span class="p">,</span>
                                                         <span class="n">contentType</span><span class="o">=</span><span class="n">contentType</span><span class="p">,</span> <span class="n">contentStartIndex</span><span class="o">=</span><span class="n">contentStartIndex</span><span class="p">,</span> <span class="n">subsetOfRowsToUse</span><span class="o">=</span><span class="n">subsetOfRowsToUse</span><span class="p">,</span> <span class="n">keyColumns</span><span class="o">=</span><span class="n">keyColumns</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lineNumber</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>  <span class="c"># handling of the title</span>
            <span class="n">columnOrdering</span> <span class="o">=</span> <span class="n">coreTitledMappingAction</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">)</span>
            <span class="n">titledMappingWrapper</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">TitledMapping</span><span class="p">(</span><span class="n">columnOrdering</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">arrToAdd</span> <span class="o">=</span> <span class="n">coreTitledMappingAction</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">arrToAdd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">titledMappingWrapper</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">addKey</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">arrToAdd</span><span class="p">)</span>
    <span class="n">performActionOnEachLineOfFile</span><span class="p">(</span>
        <span class="n">fileHandle</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">defaultTabSeppd</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">titledMappingWrapper</span><span class="o">.</span><span class="n">var</span>

</div>
<div class="viewcode-block" id="writeMatrixToFile"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.writeMatrixToFile">[docs]</a><span class="k">def</span> <span class="nf">writeMatrixToFile</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">colNames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rowNames</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">colNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">fileHandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="p">(</span><span class="s">&quot;rowName</span><span class="se">\t</span><span class="s">&quot;</span> <span class="k">if</span> <span class="n">rowNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">colNames</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rowNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">fileHandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rowNames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">stringifiedRow</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span>
        <span class="n">toWrite</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stringifiedRow</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">fileHandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">toWrite</span><span class="p">)</span>
    <span class="n">fileHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># will trim the newline for you</span>

</div>
<div class="viewcode-block" id="titleColumnToIndex"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.titleColumnToIndex">[docs]</a><span class="k">def</span> <span class="nf">titleColumnToIndex</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">trimNewline</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">valToIndexMap</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="peekAtFirstLineOfFile"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.peekAtFirstLineOfFile">[docs]</a><span class="k">def</span> <span class="nf">peekAtFirstLineOfFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="n">fh</span> <span class="o">=</span> <span class="n">getFileHandle</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">line</span>

</div>
<div class="viewcode-block" id="getTitleOfFile"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.getTitleOfFile">[docs]</a><span class="k">def</span> <span class="nf">getTitleOfFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">defaultTabSeppd</span><span class="p">(</span><span class="n">peekAtFirstLineOfFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">title</span>

</div>
<div class="viewcode-block" id="FastaIterator"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.FastaIterator">[docs]</a><span class="k">class</span> <span class="nc">FastaIterator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator over lines of a fasta file - assumes each sequence</span>
<span class="sd">        spans only one line!</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileHandle</span><span class="p">,</span> <span class="n">progressUpdate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">progressUpdateFileName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileHandle</span> <span class="o">=</span> <span class="n">fileHandle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressUpdate</span> <span class="o">=</span> <span class="n">progressUpdate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressUpdateFileName</span> <span class="o">=</span> <span class="n">progressUpdateFileName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineCount</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="FastaIterator.next"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.FastaIterator.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">printProgress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progressUpdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineCount</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">progressUpdateFileName</span><span class="p">)</span>
        <span class="c"># should raise StopIteration if at end of lines</span>
        <span class="n">keyLine</span> <span class="o">=</span> <span class="n">trimNewline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileHandle</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="n">trimNewline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileHandle</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">keyLine</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;&gt;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s">&quot;Expecting a record name line that begins with &gt; but got &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">keyLine</span><span class="p">))</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">keyLine</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&quot;&gt;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">key</span><span class="p">,</span> <span class="n">sequence</span>

</div></div>
<div class="viewcode-block" id="BackupForWriteFileHandle"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.BackupForWriteFileHandle">[docs]</a><span class="k">class</span> <span class="nc">BackupForWriteFileHandle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper around a filehandle that</span>
<span class="sd">            backs up the file while writing,</span>
<span class="sd">            then deletes the backup when close</span>
<span class="sd">            is called</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="n">fileName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backupFileName</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s">&quot;.backup&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;cp &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">backupFileName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputFileHandle</span> <span class="o">=</span> <span class="n">getFileHandle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="BackupForWriteFileHandle.write"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.BackupForWriteFileHandle.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputFileHandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BackupForWriteFileHandle.close"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.BackupForWriteFileHandle.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputFileHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;rm &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">backupFileName</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BackupForWriteFileHandle.restore"><a class="viewcode-back" href="../../../dragonn.synthetic.fileProcessing.html#dragonn.synthetic.fileProcessing.BackupForWriteFileHandle.restore">[docs]</a>    <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;cp &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">backupFileName</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;rm &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">backupFileName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputFileHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Johnny Israeli, Michael Wainberg, Avanti Shrikumar.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>