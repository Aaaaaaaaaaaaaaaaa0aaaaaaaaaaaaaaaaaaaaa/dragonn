

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>dragonn.prg &mdash; DragoNN 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="DragoNN 0.1 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> DragoNN</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../dragonn.html">dragonn package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dragonn.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dragonn.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dragonn.html#module-dragonn">Module contents</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">DragoNN</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>dragonn.prg</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for dragonn.prg</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot; Software to create Precision-Recall-Gain curves.</span>

<span class="sd">Precision-Recall-Gain curves and how to cite this work is available at</span>
<span class="sd">http://www.cs.bris.ac.uk/~flach/PRGcurves/.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Meelis Kull, Telmo de Menezes e Silva Filho, and Miquel Perello Nieto&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Meelis Kull&quot;</span><span class="p">,</span> <span class="s">&quot;Telmo de Menezes e Silva Filho&quot;</span><span class="p">,</span>
               <span class="s">&quot;Miquel Perello Nieto&quot;</span><span class="p">]</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s">&quot;Meelis Kull&quot;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s">&quot;Prototype&quot;</span>

<div class="viewcode-block" id="precision"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.precision">[docs]</a><span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tp</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="recall"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.recall">[docs]</a><span class="k">def</span> <span class="nf">recall</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tp</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="precision_gain"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.precision_gain">[docs]</a><span class="k">def</span> <span class="nf">precision_gain</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculates Precision Gain from the contingency table</span>

<span class="sd">    This function calculates Precision Gain from the entries of the contingency</span>
<span class="sd">    table: number of true positives (TP), false negatives (FN), false positives</span>
<span class="sd">    (FP), and true negatives (TN). More information on Precision-Recall-Gain</span>
<span class="sd">    curves and how to cite this work is available at</span>
<span class="sd">    http://www.cs.bris.ac.uk/~flach/PRGcurves/.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_pos</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span>
    <span class="n">n_neg</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">tn</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="n">prec_gain</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="p">(</span><span class="n">n_pos</span><span class="o">/</span><span class="n">n_neg</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">fp</span><span class="o">/</span><span class="n">tp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">alen</span><span class="p">(</span><span class="n">prec_gain</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">prec_gain</span><span class="p">[</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">tn</span> <span class="o">+</span> <span class="n">fn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">prec_gain</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">prec_gain</span>

</div>
<div class="viewcode-block" id="recall_gain"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.recall_gain">[docs]</a><span class="k">def</span> <span class="nf">recall_gain</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculates Recall Gain from the contingency table</span>

<span class="sd">    This function calculates Recall Gain from the entries of the contingency</span>
<span class="sd">    table: number of true positives (TP), false negatives (FN), false positives</span>
<span class="sd">    (FP), and true negatives (TN). More information on Precision-Recall-Gain</span>
<span class="sd">    curves and how to cite this work is available at</span>
<span class="sd">    http://www.cs.bris.ac.uk/~flach/PRGcurves/.</span>

<span class="sd">    Args:</span>
<span class="sd">        tp (float) or ([float]): True Positives</span>
<span class="sd">        fn (float) or ([float]): False Negatives</span>
<span class="sd">        fp (float) or ([float]): False Positives</span>
<span class="sd">        tn (float) or ([float]): True Negatives</span>
<span class="sd">    Returns:</span>
<span class="sd">        (float) or ([float])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_pos</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span>
    <span class="n">n_neg</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">tn</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="n">rg</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="p">(</span><span class="n">n_pos</span><span class="o">/</span><span class="n">n_neg</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">fn</span><span class="o">/</span><span class="n">tp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">alen</span><span class="p">(</span><span class="n">rg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">rg</span><span class="p">[</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">tn</span> <span class="o">+</span> <span class="n">fn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">rg</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">rg</span>

</div>
<div class="viewcode-block" id="sort_scores"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.sort_scores">[docs]</a><span class="k">def</span> <span class="nf">sort_scores</span><span class="p">(</span><span class="n">pos_scores</span><span class="p">,</span> <span class="n">neg_scores</span><span class="p">):</span>
    <span class="n">to_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="o">-</span><span class="n">pos_scores</span><span class="p">,</span> <span class="o">-</span><span class="n">neg_scores</span><span class="p">])</span>
    <span class="n">new_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">to_sort</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">new_order</span>

</div>
<div class="viewcode-block" id="create_segments"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.create_segments">[docs]</a><span class="k">def</span> <span class="nf">create_segments</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">pos_scores</span><span class="p">,</span> <span class="n">neg_scores</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">alen</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="c"># reorder labels and pos_scores by decreasing pos_scores, using increasing neg_scores in breaking ties</span>
    <span class="n">new_order</span> <span class="o">=</span> <span class="n">sort_scores</span><span class="p">(</span><span class="n">pos_scores</span><span class="p">,</span> <span class="n">neg_scores</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">new_order</span><span class="p">]</span>
    <span class="n">pos_scores</span> <span class="o">=</span> <span class="n">pos_scores</span><span class="p">[</span><span class="n">new_order</span><span class="p">]</span>
    <span class="n">neg_scores</span> <span class="o">=</span> <span class="n">neg_scores</span><span class="p">[</span><span class="n">new_order</span><span class="p">]</span>
    <span class="c"># create a table of segments</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;pos_score&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="s">&#39;neg_score&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
                <span class="s">&#39;pos_count&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="s">&#39;neg_count&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)}</span>
    <span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">pos_scores</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">pos_scores</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                     <span class="ow">or</span> <span class="p">(</span><span class="n">neg_scores</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">neg_scores</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">segments</span><span class="p">[</span><span class="s">&#39;pos_score&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">segments</span><span class="p">[</span><span class="s">&#39;neg_score&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">neg_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">segments</span><span class="p">[</span><span class="s">&#39;neg_count&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">segments</span><span class="p">[</span><span class="s">&#39;pos_count&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">segments</span><span class="p">[</span><span class="s">&#39;pos_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="s">&#39;pos_score&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">segments</span><span class="p">[</span><span class="s">&#39;neg_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="s">&#39;neg_score&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">segments</span><span class="p">[</span><span class="s">&#39;pos_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="s">&#39;pos_count&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">segments</span><span class="p">[</span><span class="s">&#39;neg_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="s">&#39;neg_count&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">segments</span>

</div>
<div class="viewcode-block" id="get_point"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.get_point">[docs]</a><span class="k">def</span> <span class="nf">get_point</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">alen</span><span class="p">(</span><span class="n">keys</span><span class="p">))</span>
    <span class="n">key_indices</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
        <span class="n">point</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
        <span class="n">key_indices</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">point</span><span class="p">,</span> <span class="n">key_indices</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="insert_point"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.insert_point">[docs]</a><span class="k">def</span> <span class="nf">insert_point</span><span class="p">(</span><span class="n">new_point</span><span class="p">,</span> <span class="n">key_indices</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">precision_gain</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">recall_gain</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">is_crossing</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_indices</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">points</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">new_point</span><span class="p">[</span><span class="n">key_indices</span><span class="p">[</span><span class="n">key</span><span class="p">]])</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;precision_gain&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_gain</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;recall_gain&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall_gain</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;is_crossing&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_crossing</span>
    <span class="n">new_order</span> <span class="o">=</span> <span class="n">sort_scores</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s">&#39;pos_score&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;neg_score&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">points</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">points</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">new_order</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">points</span>

</div>
<span class="k">def</span> <span class="nf">_create_crossing_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">n_pos</span><span class="p">,</span> <span class="n">n_neg</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n_pos</span><span class="o">+</span><span class="n">n_neg</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;is_crossing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">alen</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s">&#39;pos_score&#39;</span><span class="p">]))</span>
    <span class="c"># introduce a crossing point at the crossing through the y-axis</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s">&#39;recall_gain&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;recall_gain&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># otherwise there is a point on the boundary and no need for a crossing point</span>
        <span class="p">[</span><span class="n">point_1</span><span class="p">,</span> <span class="n">key_indices_1</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_point</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="p">[</span><span class="n">point_2</span><span class="p">,</span> <span class="n">key_indices_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_point</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">point_1</span> <span class="o">-</span> <span class="n">point_2</span>
        <span class="k">if</span> <span class="n">delta</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_pos</span><span class="o">*</span><span class="n">n_pos</span><span class="o">/</span><span class="n">n</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">delta</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="n">new_point</span> <span class="o">=</span> <span class="n">point_2</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">delta</span>

        <span class="n">new_prec_gain</span> <span class="o">=</span> <span class="n">precision_gain</span><span class="p">(</span><span class="n">new_point</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">]],</span> <span class="n">new_point</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;FN&#39;</span><span class="p">]],</span>
                                       <span class="n">new_point</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;FP&#39;</span><span class="p">]],</span> <span class="n">new_point</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;TN&#39;</span><span class="p">]])</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">insert_point</span><span class="p">(</span><span class="n">new_point</span><span class="p">,</span> <span class="n">key_indices_1</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span>
                              <span class="n">precision_gain</span><span class="o">=</span><span class="n">new_prec_gain</span><span class="p">,</span> <span class="n">is_crossing</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># now introduce crossing points at the crossings through the non-negative part of the x-axis</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;recall_gain&#39;</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;precision_gain&#39;</span><span class="p">]</span>
    <span class="n">temp_y_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">temp_0_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">temp_1_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">((</span><span class="n">temp_y_0</span> <span class="o">*</span> <span class="n">temp_0_y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">temp_1_x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">cross_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">[</span><span class="n">point_1</span><span class="p">,</span> <span class="n">key_indices_1</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_point</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="p">[</span><span class="n">point_2</span><span class="p">,</span> <span class="n">key_indices_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_point</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">point_1</span> <span class="o">-</span> <span class="n">point_2</span>
        <span class="k">if</span> <span class="n">delta</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_pos</span> <span class="o">*</span> <span class="n">n_pos</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">n_neg</span> <span class="o">*</span> <span class="n">cross_x</span><span class="p">)</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">delta</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_neg</span> <span class="o">/</span> <span class="n">n_pos</span> <span class="o">*</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;FP&#39;</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">delta</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;FP&#39;</span><span class="p">]]</span>

        <span class="n">new_point</span> <span class="o">=</span> <span class="n">point_2</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">delta</span>
        <span class="n">new_rec_gain</span> <span class="o">=</span> <span class="n">recall_gain</span><span class="p">(</span><span class="n">new_point</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">]],</span> <span class="n">new_point</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;FN&#39;</span><span class="p">]],</span>
                                   <span class="n">new_point</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;FP&#39;</span><span class="p">]],</span> <span class="n">new_point</span><span class="p">[</span><span class="n">key_indices_1</span><span class="p">[</span><span class="s">&#39;TN&#39;</span><span class="p">]])</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">insert_point</span><span class="p">(</span><span class="n">new_point</span><span class="p">,</span> <span class="n">key_indices_1</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span>
                              <span class="n">recall_gain</span><span class="o">=</span><span class="n">new_rec_gain</span><span class="p">,</span> <span class="n">is_crossing</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">indices</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;recall_gain&#39;</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;precision_gain&#39;</span><span class="p">]</span>
        <span class="n">temp_y_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">temp_0_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">temp_1_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">points</span>


<div class="viewcode-block" id="create_prg_curve"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.create_prg_curve">[docs]</a><span class="k">def</span> <span class="nf">create_prg_curve</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">pos_scores</span><span class="p">,</span> <span class="n">neg_scores</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">create_crossing_points</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">alen</span><span class="p">(</span><span class="n">neg_scores</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">neg_scores</span> <span class="o">=</span> <span class="o">-</span><span class="n">pos_scores</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">alen</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">n_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">n_neg</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">n_pos</span>
    <span class="c"># convert negative labels into 0s</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="n">create_segments</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">pos_scores</span><span class="p">,</span> <span class="n">neg_scores</span><span class="p">)</span>
    <span class="c"># calculate recall gains and precision gains for all thresholds</span>
    <span class="n">points</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;pos_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">segments</span><span class="p">[</span><span class="s">&#39;pos_score&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;neg_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">segments</span><span class="p">[</span><span class="s">&#39;neg_score&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">segments</span><span class="p">[</span><span class="s">&#39;pos_count&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;FP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">segments</span><span class="p">[</span><span class="s">&#39;neg_count&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;FN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_pos</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">]</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;TN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_neg</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;FP&#39;</span><span class="p">]</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;precision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;FN&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;FP&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;TN&#39;</span><span class="p">])</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;recall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;FN&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;FP&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;TN&#39;</span><span class="p">])</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;precision_gain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_gain</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;FN&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;FP&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;TN&#39;</span><span class="p">])</span>
    <span class="n">points</span><span class="p">[</span><span class="s">&#39;recall_gain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall_gain</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;FN&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;FP&#39;</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;TN&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">create_crossing_points</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">_create_crossing_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">n_pos</span><span class="p">,</span> <span class="n">n_neg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">points</span><span class="p">[</span><span class="s">&#39;pos_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;pos_score&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
       <span class="n">points</span><span class="p">[</span><span class="s">&#39;neg_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;neg_score&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
       <span class="n">points</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;TP&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
       <span class="n">points</span><span class="p">[</span><span class="s">&#39;FP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;FP&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
       <span class="n">points</span><span class="p">[</span><span class="s">&#39;FN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;FN&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
       <span class="n">points</span><span class="p">[</span><span class="s">&#39;TN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;TN&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
       <span class="n">points</span><span class="p">[</span><span class="s">&#39;precision_gain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;precision_gain&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
       <span class="n">points</span><span class="p">[</span><span class="s">&#39;recall_gain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s">&#39;recall_gain&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="n">points</span><span class="p">[</span><span class="s">&#39;in_unit_square&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s">&#39;recall_gain&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                                              <span class="n">points</span><span class="p">[</span><span class="s">&#39;precision_gain&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">points</span>

</div>
<div class="viewcode-block" id="calc_auprg"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.calc_auprg">[docs]</a><span class="k">def</span> <span class="nf">calc_auprg</span><span class="p">(</span><span class="n">prg_curve</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate area under the Precision-Recall-Gain curve</span>

<span class="sd">    This function calculates the area under the Precision-Recall-Gain curve</span>
<span class="sd">    from the results of the function create_prg_curve. More information on</span>
<span class="sd">    Precision-Recall-Gain curves and how to cite this work is available at</span>
<span class="sd">    http://www.cs.bris.ac.uk/~flach/PRGcurves/.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">area</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">recall_gain</span> <span class="o">=</span> <span class="n">prg_curve</span><span class="p">[</span><span class="s">&#39;recall_gain&#39;</span><span class="p">]</span>
    <span class="n">precision_gain</span> <span class="o">=</span> <span class="n">prg_curve</span><span class="p">[</span><span class="s">&#39;precision_gain&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">recall_gain</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">recall_gain</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">recall_gain</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">recall_gain</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">recall_gain</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">precision_gain</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">precision_gain</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">area</span> <span class="o">+=</span> <span class="n">width</span><span class="o">*</span><span class="n">height</span>
    <span class="k">return</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>


<span class="c"># from </span></div>
<div class="viewcode-block" id="convex_hull"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.convex_hull">[docs]</a><span class="k">def</span> <span class="nf">convex_hull</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the convex hull of a set of 2D points.</span>

<span class="sd">    Input: an iterable sequence of (x, y) pairs representing the points.</span>
<span class="sd">    Output: a list of vertices of the convex hull in counter-clockwise order,</span>
<span class="sd">      starting from the vertex with the lexicographically smallest coordinates.</span>
<span class="sd">    Implements Andrew&#39;s monotone chain algorithm. O(n log n) complexity.</span>
<span class="sd">    Source code from:</span>
<span class="sd">    https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Sort the points lexicographically (tuples are compared lexicographically).</span>
    <span class="c"># Remove duplicates to detect the case we have just one unique point.</span>
    <span class="n">points</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>

    <span class="c"># Boring case: no points or a single point, possibly repeated multiple times.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">points</span>

    <span class="c"># 2D cross product of OA and OB vectors, i.e. z-component of their 3D cross product.</span>
    <span class="c"># Returns a positive value, if OAB makes a counter-clockwise turn,</span>
    <span class="c"># negative for clockwise turn, and zero if the points are collinear.</span>
    <span class="k">def</span> <span class="nf">cross</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c"># Build upper hull</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">cross</span><span class="p">(</span><span class="n">upper</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">upper</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">upper</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">upper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">upper</span>


<span class="c">#&#39; Plot the Precision-Recall-Gain curve</span>
<span class="c">#&#39;</span>
<span class="c">#&#39; This function plots the Precision-Recall-Gain curve resulting from the function create_prg_curve using ggplot. More information on Precision-Recall-Gain curves and how to cite this work is available at http://www.cs.bris.ac.uk/~flach/PRGcurves/.</span>
<span class="c">#&#39; @param prg_curve the data structure resulting from the function create_prg_curve</span>
<span class="c">#&#39; @param show_convex_hull whether to show the convex hull (default: TRUE)</span>
<span class="c">#&#39; @param show_f_calibrated_scores whether to show the F-calibrated scores (default:TRUE)</span>
<span class="c">#&#39; @return the ggplot object which can be plotted using print()</span>
<span class="c">#&#39; @details This function plots the Precision-Recall-Gain curve, indicating for each point whether it is a crossing-point or not (see help on create_prg_curve). By default, only the part of the curve within the unit square [0,1]x[0,1] is plotted.</span>
<span class="c">#&#39; @examples</span>
<span class="c">#&#39; labels = c(1,1,1,0,1,1,1,1,1,1,0,1,1,1,0,1,0,0,1,0,0,0,1,0,1)</span>
<span class="c">#&#39; scores = (25:1)/25</span>
<span class="c">#&#39; plot_prg(create_prg_curve(labels,scores))</span></div>
<div class="viewcode-block" id="plot_prg"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.plot_prg">[docs]</a><span class="k">def</span> <span class="nf">plot_prg</span><span class="p">(</span><span class="n">prg_curve</span><span class="p">,</span><span class="n">show_convex_hull</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">show_f_calibrated_scores</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">pg</span> <span class="o">=</span> <span class="n">prg_curve</span><span class="p">[</span><span class="s">&#39;precision_gain&#39;</span><span class="p">]</span>
    <span class="n">rg</span> <span class="o">=</span> <span class="n">prg_curve</span><span class="p">[</span><span class="s">&#39;recall_gain&#39;</span><span class="p">]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">1.02</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">1.02</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
    <span class="c"># Plot vertical and horizontal lines crossing the 0 axis</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="c"># Plot cyan lines</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prg_curve</span><span class="p">[</span><span class="s">&#39;in_unit_square&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">prg_curve</span><span class="p">[</span><span class="s">&#39;in_unit_square&#39;</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rg</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">pg</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="s">&#39;c-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c"># Plot blue lines</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">prg_curve</span><span class="p">[</span><span class="s">&#39;is_crossing&#39;</span><span class="p">],</span>
                       <span class="n">prg_curve</span><span class="p">[</span><span class="s">&#39;in_unit_square&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rg</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">pg</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="s">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c"># Plot blue dots</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">prg_curve</span><span class="p">[</span><span class="s">&#39;in_unit_square&#39;</span><span class="p">],</span>
                             <span class="bp">True</span> <span class="o">-</span> <span class="n">prg_curve</span><span class="p">[</span><span class="s">&#39;is_crossing&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rg</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">pg</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
    <span class="c"># Plot lines out of the boundaries</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Recall Gain&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Precision Gain&#39;</span><span class="p">)</span>

    <span class="n">valid_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">True</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rg</span><span class="p">),</span> <span class="bp">True</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">pg</span><span class="p">))</span>
    <span class="n">upper_hull</span> <span class="o">=</span> <span class="n">convex_hull</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rg</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span><span class="n">pg</span><span class="p">[</span><span class="n">valid_points</span><span class="p">]))</span>
    <span class="n">rg_hull</span><span class="p">,</span> <span class="n">pg_hull</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">upper_hull</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_convex_hull</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rg_hull</span><span class="p">,</span> <span class="n">pg_hull</span><span class="p">,</span> <span class="s">&#39;r--&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_f_calibrated_scores</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Show calibrated scores not implemented yet&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="plot_pr"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.plot_pr">[docs]</a><span class="k">def</span> <span class="nf">plot_pr</span><span class="p">(</span><span class="n">prg_curve</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">prg_curve</span><span class="p">[</span><span class="s">&#39;precision&#39;</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">prg_curve</span><span class="p">[</span><span class="s">&#39;recall&#39;</span><span class="p">]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">1.02</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">1.02</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
    <span class="c"># Plot vertical and horizontal lines crossing the 0 axis</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="c"># Plot blue lines</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s">&#39;ob-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Recall&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Precision&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="test"><a class="viewcode-back" href="../../dragonn.prg.html#dragonn.prg.test">[docs]</a><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">prg_curve</span> <span class="o">=</span> <span class="n">create_prg_curve</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">create_crossing_points</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">auprg</span> <span class="o">=</span> <span class="n">calc_auprg</span><span class="p">(</span><span class="n">prg_curve</span><span class="p">)</span>
    <span class="n">plot_prg</span><span class="p">(</span><span class="n">prg_curve</span><span class="p">)</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Johnny Israeli, Michael Wainberg, Avanti Shrikumar.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>